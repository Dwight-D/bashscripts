#!/bin/bash
#Script for starting new scripts

name=""
overwrite=false
args=0
opts=""


usage (){
    echo "${0##*/} - Generates a bash script stub."
    echo "Usage: $(basename $0) name [nrOfargs] [opts]"
    exit 1
}

#       Parse options
#=============================

while getopts "oh" opt; do
    case $opt in
        h )
            usage
            ;;
        o )
            overwrite=true
            ;;
        ? )
            usage
            ;;
     esac
done
shift $((OPTIND -1))


#      Parse arguments
#===============================

if [ "$#" -lt 1 ]; then
    usage
fi
echo -n "Generating script $name"

if [ ! -z "$2" ]; then
    args=$2
    echo " with $args arguments "
fi

if [ ! -z "$3" ]; then
    opts="$3"
    echo "Opts: $opts"
fi

name=$1
if [ -f $1 ]; then
    if [ "$overwrite" = false ]; then
        echo "Error: File exists!"
        exit
    fi
fi

#      Begin output
#=================================

#Brackets redirect all output to target file
{
touch $name
chmod +x $name
echo "#!/bin/bash
#Autogenerated script template
"

#Create argument declarations

echo "#     Variable declarations
#========================================
"
echo "me=\${0##*/}"
for (( i=0; i<$args; i++ )); do
  echo "_arg${i}_=\"\""
done

#Generate usage function
echo '
usage (){
    echo "$me - Description missing"
    echo "Usage: $me"
    exit 1
}'

#Generate opts parsing

echo "

#       Parse options
#=======================================

while getopts \"h$opts\" opt; do"

echo '    case $opt in'

for (( i=0; i<${#opts}; i++ )); do
    echo "        ${opts:$i:1})
            #dostuff
            ;;"
done
echo '        h )
            usage
            ;;
        \? )
            usage
            ;;
        : )
            echo "Option requires an argument: $OPTARG"
            exit
            ;;
    esac
done
shift $((OPTIND -1))
'

echo -n 'if [ "$#" -lt '
echo "$args ]; then
    usage
fi
"
}> $name
$EDITOR $name
